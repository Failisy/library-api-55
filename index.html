<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„ì„œ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' https://accounts.google.com https://apis.google.com https://www.gstatic.com;">
    
    <link rel="stylesheet" href="style.css">
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        const CLIENT_ID = "650457472463-1bg83e4nvs912fnv9u6dnbupb6glj1g9.apps.googleusercontent.com";  // Google OAuth í´ë¼ì´ì–¸íŠ¸ ID
        const API_KEY = "AIzaSyA3_dlMzkw6N3fG2zl-Hwj__864TxzkNNE";   // Google API í‚¤

        let bookData = [];  // ë„ì„œ ëª©ë¡ ë°ì´í„°ë¥¼ ì €ì¥í•  ë°°ì—´

        // Google OAuth ì¸ì¦ ì´ˆê¸°í™”
        function initGoogleAuth() {
            gapi.load("auth2", function() {
                gapi.auth2.init({ client_id: CLIENT_ID });
            });
        }

        // Google ë¡œê·¸ì¸
        function signIn() {
            const auth2 = gapi.auth2.getAuthInstance();
            auth2.signIn().then(function(googleUser) {
                const profile = googleUser.getBasicProfile();
                document.getElementById("login-status").innerText = `ë¡œê·¸ì¸í•œ ì‚¬ìš©ì: ${profile.getEmail()}`;
                // ë¡œê·¸ì¸ í›„ ì¶”ê°€ ì‘ì—… (ì˜ˆ: ê´€ë¦¬ìì¸ì§€ í™•ì¸)
            }).catch(function(error) {
                console.error("Login error:", error);
            });
        }

        // Google ë¡œê·¸ì•„ì›ƒ
        function signOut() {
            const auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(function() {
                document.getElementById("login-status").innerText = "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.";
            });
        }

        // ë„ì„œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        function fetchBooks() {
            const spreadsheetId = "1cdECKnvPoVWmvw36BDEp5JeIRHKXRaGHeaqqWWRB9Ow";  // ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ID
            const range = "books";  // ë„ì„œ ëª©ë¡ì´ ìˆëŠ” ì‹œíŠ¸ ì´ë¦„
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${API_KEY}`;
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    bookData = data.values.slice(1);  // ì²« ë²ˆì§¸ í–‰(í—¤ë”)ì„ ì œì™¸í•˜ê³  ë°ì´í„° ì €ì¥
                    displayBooks(bookData);  // ë„ì„œ ëª©ë¡ í™”ë©´ì— í‘œì‹œ
                })
                .catch(error => console.error('ë„ì„œ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error));
        }

        // ë„ì„œ ëª©ë¡ í™”ë©´ì— í‘œì‹œ
        function displayBooks(books) {
            const bookListDiv = document.getElementById("book-list");
            bookListDiv.innerHTML = "";  // ê¸°ì¡´ ëª©ë¡ì„ ì§€ìš´ í›„ ìƒˆë¡œ ì¶”ê°€

            books.forEach(book => {
                const bookElement = document.createElement("div");
                bookElement.innerHTML = `
                    <h3>${book[1]}</h3> <!-- ì±… ì œëª© -->
                    <p>ì €ì: ${book[2]}</p>
                    <p>ì¶œíŒì‚¬: ${book[3]}</p>
                    <p>ISBN: ${book[4]}</p>
                    <p>ê³ ìœ  ID: ${book[0]}</p> <!-- ê³ ìœ  ID -->
                `;
                bookListDiv.appendChild(bookElement);
            });
        }

        // ë„ì„œ ê²€ìƒ‰
        function searchBooks() {
            const searchTerm = document.getElementById("search-input").value.toLowerCase();
            const filteredBooks = bookData.filter(book => {
                return (
                    book[1].toLowerCase().includes(searchTerm) ||  // ì œëª© ê²€ìƒ‰
                    book[2].toLowerCase().includes(searchTerm) ||  // ì €ì ê²€ìƒ‰
                    book[4].includes(searchTerm)                   // ISBN ê²€ìƒ‰
                );
            });
            displayBooks(filteredBooks);  // í•„í„°ë§ëœ ë„ì„œ ëª©ë¡ì„ ë‹¤ì‹œ í‘œì‹œ
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ Google OAuth ì´ˆê¸°í™”
        window.onload = function() {
            initGoogleAuth();
            fetchBooks();  // ë„ì„œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        };
    </script>
</head>
<body>
    <h1>ğŸ“š ë„ì„œ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>

    <!-- Google ë¡œê·¸ì¸ / ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
    <button onclick="signIn()">Google ë¡œê·¸ì¸</button>
    <button onclick="signOut()">ë¡œê·¸ì•„ì›ƒ</button>
    <p id="login-status">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>

    <!-- ë„ì„œ ê²€ìƒ‰ì°½ -->
    <input type="text" id="search-input" placeholder="ğŸ” ì±… ì œëª©, ì €ì, ISBN ê²€ìƒ‰" oninput="searchBooks()">

    <!-- ë„ì„œ ëª©ë¡ -->
    <h2>ğŸ“– ë„ì„œ ëª©ë¡</h2>
    <div id="book-list"></div>

</body>
</html>
