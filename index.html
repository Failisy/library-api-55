<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„ì„œ ê´€ë¦¬ API í…ŒìŠ¤íŠ¸</title>
</head>
<body>
    <h1>ğŸ“š ë„ì„œ ê´€ë¦¬ API í…ŒìŠ¤íŠ¸</h1>

    <!-- GAS API URL ìë™ ì„¤ì • -->
    <label for="apiUrl">GAS API URL:</label>
    <input type="text" id="apiUrl" value="https://script.google.com/macros/s/AKfycby_OnqGJfUcxvpJDJkcjaAmFr2Ht9k6uNZ2CKw6YzuENaDJre-JUN2MlsOk3eZKqKOv3A/exec" size="80" readonly>
    
    <hr>

    <!-- ë„ì„œ ê²€ìƒ‰ -->
    <h2>ğŸ” ë„ì„œ ê²€ìƒ‰</h2>
    <input type="text" id="searchQuery" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥">
    <button onclick="searchBook()">ê²€ìƒ‰</button>
    <pre id="searchResult"></pre>

    <hr>

    <!-- ë„ì„œ ëŒ€ì¶œ -->
    <h2>ğŸ“– ë„ì„œ ëŒ€ì¶œ</h2>
    <input type="text" id="bookId" placeholder="ë„ì„œ ID">
    <input type="text" id="gunbun" placeholder="êµ°ë²ˆ">
    <input type="text" id="rank" placeholder="ê³„ê¸‰">
    <input type="text" id="name" placeholder="ì´ë¦„">
    <input type="text" id="unit" placeholder="ë¶€ëŒ€">
    <button onclick="borrowBook()">ëŒ€ì¶œ</button>
    <pre id="borrowResult"></pre>

    <hr>

    <!-- ë„ì„œ ë°˜ë‚© -->
    <h2>ğŸ“• ë„ì„œ ë°˜ë‚©</h2>
    <input type="text" id="returnBookId" placeholder="ë„ì„œ ID">
    <input type="text" id="returnName" placeholder="ì´ë¦„">
    <button onclick="returnBook()">ë°˜ë‚©</button>
    <pre id="returnResult"></pre>

    <script>
        // ğŸ“Œ ë„ì„œ ê²€ìƒ‰
        async function searchBook() {
            const apiUrl = document.getElementById("apiUrl").value.trim();
            const query = document.getElementById("searchQuery").value.trim();

            if (!query) {
                alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”!");
                return;
            }

            try {
                console.log(`ğŸ” ìš”ì²­ URL: ${apiUrl}?action=search&query=${query}`);

                const response = await fetch(`${apiUrl}?action=search&query=${query}`, {
                    method: "GET",
                    mode: "cors",
                    cache: "no-cache"
                });

                if (!response.ok) throw new Error(`HTTP ì˜¤ë¥˜! ìƒíƒœ ì½”ë“œ: ${response.status}`);

                const text = await response.text();
                console.log("âœ… API ì‘ë‹µ:", text);

                document.getElementById("searchResult").innerText = text || "ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ";
            } catch (error) {
                console.error("âŒ ê²€ìƒ‰ ì˜¤ë¥˜:", error);
                document.getElementById("searchResult").innerText = "ì˜¤ë¥˜ ë°œìƒ! ê°œë°œì ë„êµ¬(Console) í™•ì¸";
            }
        }

        // ğŸ“Œ ë„ì„œ ëŒ€ì¶œ
        async function borrowBook() {
            const apiUrl = document.getElementById("apiUrl").value.trim();
            const id = document.getElementById("bookId").value.trim();
            const gunbun = document.getElementById("gunbun").value.trim();
            const rank = document.getElementById("rank").value.trim();
            const name = document.getElementById("name").value.trim();
            const unit = document.getElementById("unit").value.trim();

            if (!id || !gunbun || !rank || !name || !unit) {
                alert("ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”!");
                return;
            }

            try {
                const response = await fetch(`${apiUrl}?action=borrow&id=${id}&gunbun=${gunbun}&rank=${rank}&name=${name}&unit=${unit}`, {
                    method: "GET",
                    mode: "cors",
                    cache: "no-cache"
                });

                if (!response.ok) throw new Error(`HTTP ì˜¤ë¥˜! ìƒíƒœ ì½”ë“œ: ${response.status}`);

                const text = await response.text();
                console.log("âœ… ëŒ€ì¶œ ì‘ë‹µ:", text);

                document.getElementById("borrowResult").innerText = text;
            } catch (error) {
                console.error("âŒ ëŒ€ì¶œ ì˜¤ë¥˜:", error);
                document.getElementById("borrowResult").innerText = "ì˜¤ë¥˜ ë°œìƒ!";
            }
        }

        // ğŸ“Œ ë„ì„œ ë°˜ë‚©
        async function returnBook() {
            const apiUrl = document.getElementById("apiUrl").value.trim();
            const id = document.getElementById("returnBookId").value.trim();
            const name = document.getElementById("returnName").value.trim();

            if (!id || !name) {
                alert("ë„ì„œ IDì™€ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!");
                return;
            }

            try {
                const response = await fetch(`${apiUrl}?action=return&id=${id}&name=${name}`, {
                    method: "GET",
                    mode: "cors",
                    cache: "no-cache"
                });

                if (!response.ok) throw new Error(`HTTP ì˜¤ë¥˜! ìƒíƒœ ì½”ë“œ: ${response.status}`);

                const text = await response.text();
                console.log("âœ… ë°˜ë‚© ì‘ë‹µ:", text);

                document.getElementById("returnResult").innerText = text;
            } catch (error) {
                console.error("âŒ ë°˜ë‚© ì˜¤ë¥˜:", error);
                document.getElementById("returnResult").innerText = "ì˜¤ë¥˜ ë°œìƒ!";
            }
        }
    </script>
</body>
</html>
